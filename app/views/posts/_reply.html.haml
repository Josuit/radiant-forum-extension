/// this template is generally only where you don't want a reply form on the page by default,
/// and instead bring it in with a remote call. most often this is for page comments, where
/// it has the advantage that the page can still be cached. that's why a login form might be returned.

- message_type = @page ? 'comment' : 'reply'
- formurl = @page ? page_posts_url(@page) : topic_posts_url(@topic)
- @post ||= @topic.posts.build

- if current_reader
  %div.reply#replyform
    %h2.inviting
      Post a 
      = message_type
    - form_for :post, :url => formurl, :html => {:id => 'reply_form', :multipart => true, :class => 'friendly'} do |f|
      = render :partial => "posts/form", :object => f
      = submit_tag "Post #{message_type}"

    %p.formnote
      You are currently logged in as 
      = link_to(current_reader.name, reader_url(current_reader)) + '.'
      If that's not you, please 
      = link_to("log out", reader_logout_url) + '.'

- else
  %h2.inviting 
    To add a
    = message_type
    please log in
  = render :partial => 'reader_sessions/login_form'
